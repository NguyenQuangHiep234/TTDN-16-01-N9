<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Form view cho Risk Assessment -->
        <record id="view_risk_assessment_form" model="ir.ui.view">
            <field name="name">risk.assessment.form</field>
            <field name="model">risk.assessment</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_enhance_with_gemini" 
                                string="ü§ñ N√¢ng c·∫•p v·ªõi Gemini AI" 
                                type="object" 
                                class="btn-primary"
                                attrs="{'invisible': [('status', 'in', ['resolved', 'accepted'])]}"/>
                        
                        <button name="action_start_mitigation" 
                                string="B·∫Øt ƒë·∫ßu kh·∫Øc ph·ª•c" 
                                type="object" 
                                class="btn-warning"
                                attrs="{'invisible': [('status', 'not in', ['identified', 'analyzing'])]}"/>
                        
                        <button name="action_resolve" 
                                string="ƒê√°nh d·∫•u ƒë√£ gi·∫£i quy·∫øt" 
                                type="object" 
                                class="btn-success"
                                attrs="{'invisible': [('status', 'in', ['resolved', 'accepted'])]}"/>
                        
                        <button name="action_accept_risk" 
                                string="Ch·∫•p nh·∫≠n r·ªßi ro" 
                                type="object" 
                                class="btn-secondary"
                                attrs="{'invisible': [('status', 'in', ['resolved', 'accepted'])]}"/>
                        
                        <field name="status" widget="statusbar" 
                               statusbar_visible="identified,analyzing,mitigating,resolved"/>
                    </header>
                    <sheet>
                        <widget name="web_ribbon" title="AI Detected" 
                                bg_color="bg-info" attrs="{'invisible': [('is_ai_detected', '=', False)]}"/>
                        
                        <div class="oe_title">
                            <label for="name"/>
                            <h1><field name="name" placeholder="T√™n r·ªßi ro..."/></h1>
                        </div>
                        
                        <group>
                            <group>
                                <field name="risk_type"/>
                                <field name="risk_level" 
                                       decoration-success="risk_level == 'low'"
                                       decoration-warning="risk_level == 'medium'"
                                       decoration-danger="risk_level in ['high', 'critical']"/>
                                <field name="project_id" options="{'no_create': True}"/>
                                <field name="assigned_to" options="{'no_create': True}"/>
                            </group>
                            <group>
                                <field name="probability" widget="percentage"/>
                                <field name="impact_score"/>
                                <field name="risk_score" readonly="1"/>
                                <field name="is_ai_detected" invisible="1"/>
                                <field name="ai_confidence" widget="percentage" 
                                       attrs="{'invisible': [('is_ai_detected', '=', False)]}"/>
                            </group>
                        </group>
                        
                        <group>
                            <group>
                                <field name="detected_date"/>
                                <field name="resolved_date" readonly="1"/>
                            </group>
                            <group>
                                <field name="project_progress" widget="percentage"/>
                                <field name="project_status"/>
                            </group>
                        </group>
                        
                        <notebook>
                            <page string="M√¥ t·∫£ r·ªßi ro">
                                <field name="description" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ r·ªßi ro..."/>
                            </page>
                            <page string="Nguy√™n nh√¢n g·ªëc">
                                <field name="root_cause" placeholder="Ph√¢n t√≠ch nguy√™n nh√¢n g·ªëc..."/>
                            </page>
                            <page string="K·∫ø ho·∫°ch kh·∫Øc ph·ª•c">
                                <field name="mitigation_plan" placeholder="ƒê·ªÅ xu·∫•t bi·ªán ph√°p ph√≤ng ng·ª´a/kh·∫Øc ph·ª•c..."/>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Tree view cho Risk Assessment -->
        <record id="view_risk_assessment_tree" model="ir.ui.view">
            <field name="name">risk.assessment.tree</field>
            <field name="model">risk.assessment</field>
            <field name="arch" type="xml">
                <tree decoration-danger="risk_level == 'critical'" 
                      decoration-warning="risk_level == 'high'"
                      decoration-info="risk_level == 'medium'">
                    <field name="name"/>
                    <field name="project_id"/>
                    <field name="risk_type"/>
                    <field name="risk_level" 
                           decoration-success="risk_level == 'low'"
                           decoration-warning="risk_level == 'medium'"
                           decoration-danger="risk_level in ['high', 'critical']"/>
                    <field name="probability" widget="percentage"/>
                    <field name="impact_score"/>
                    <field name="risk_score" widget="progressbar"/>
                    <field name="status" 
                           decoration-success="status == 'resolved'"
                           decoration-warning="status == 'mitigating'"
                           decoration-info="status == 'analyzing'"/>
                    <field name="assigned_to"/>
                    <field name="detected_date"/>
                    <field name="is_ai_detected" string="AI" widget="boolean"/>
                    <field name="ai_confidence" string="AI Confidence" widget="percentage"
                           attrs="{'invisible': [('is_ai_detected', '=', False)]}"/>
                </tree>
            </field>
        </record>

        <!-- Kanban view cho Risk Assessment -->
        <record id="view_risk_assessment_kanban" model="ir.ui.view">
            <field name="name">risk.assessment.kanban</field>
            <field name="model">risk.assessment</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" default_group_by="risk_level">
                    <field name="name"/>
                    <field name="risk_type"/>
                    <field name="risk_level"/>
                    <field name="risk_score"/>
                    <field name="status"/>
                    <field name="is_ai_detected"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_global_click">
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="name"/>
                                            </strong>
                                        </div>
                                        <span t-if="record.is_ai_detected.raw_value" 
                                              class="badge badge-info">AI</span>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <field name="risk_type"/>
                                        <div>ƒêi·ªÉm: <field name="risk_score"/></div>
                                        <div>Tr·∫°ng th√°i: <field name="status"/></div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Search view cho Risk Assessment -->
        <record id="view_risk_assessment_search" model="ir.ui.view">
            <field name="name">risk.assessment.search</field>
            <field name="model">risk.assessment</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="project_id"/>
                    <field name="assigned_to"/>
                    <filter string="R·ªßi ro nghi√™m tr·ªçng" name="critical" 
                            domain="[('risk_level', '=', 'critical')]"/>
                    <filter string="R·ªßi ro cao" name="high" 
                            domain="[('risk_level', '=', 'high')]"/>
                    <filter string="Ch∆∞a gi·∫£i quy·∫øt" name="active" 
                            domain="[('status', 'in', ['identified', 'analyzing', 'mitigating'])]"/>
                    <filter string="AI ph√°t hi·ªán" name="ai_detected" 
                            domain="[('is_ai_detected', '=', True)]"/>
                    <separator/>
                    <filter string="R·ªßi ro ti·∫øn ƒë·ªô" name="schedule" 
                            domain="[('risk_type', '=', 'schedule')]"/>
                    <filter string="R·ªßi ro ng√¢n s√°ch" name="budget" 
                            domain="[('risk_type', '=', 'budget')]"/>
                    <filter string="R·ªßi ro ngu·ªìn l·ª±c" name="resource" 
                            domain="[('risk_type', '=', 'resource')]"/>
                    <group expand="0" string="Nh√≥m theo">
                        <filter string="D·ª± √°n" name="group_project" context="{'group_by': 'project_id'}"/>
                        <filter string="M·ª©c ƒë·ªô" name="group_level" context="{'group_by': 'risk_level'}"/>
                        <filter string="Lo·∫°i" name="group_type" context="{'group_by': 'risk_type'}"/>
                        <filter string="Tr·∫°ng th√°i" name="group_status" context="{'group_by': 'status'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Action cho Risk Assessment -->
        <record id="action_risk_assessment" model="ir.actions.act_window">
            <field name="name">ƒê√°nh gi√° r·ªßi ro</field>
            <field name="res_model">risk.assessment</field>
            <field name="view_mode">kanban,tree,form</field>
            <field name="context">{'search_default_active': 1}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    T·∫°o ƒë√°nh gi√° r·ªßi ro m·ªõi
                </p>
                <p>
                    Click n√∫t "T·∫°o" ƒë·ªÉ th√™m r·ªßi ro th·ªß c√¥ng, ho·∫∑c d√πng n√∫t "Ph√¢n t√≠ch AI" trong d·ª± √°n ƒë·ªÉ t·ª± ƒë·ªông ph√°t hi·ªán r·ªßi ro.
                </p>
            </field>
        </record>

        <!-- Tree view cho Risk Metric -->
        <record id="view_risk_metric_tree" model="ir.ui.view">
            <field name="name">risk.metric.tree</field>
            <field name="model">risk.metric</field>
            <field name="arch" type="xml">
                <tree decoration-danger="is_anomaly == True">
                    <field name="date"/>
                    <field name="metric_type"/>
                    <field name="value"/>
                    <field name="threshold_min"/>
                    <field name="threshold_max"/>
                    <field name="is_anomaly" widget="boolean_toggle"/>
                    <field name="notes"/>
                </tree>
            </field>
        </record>

        <!-- Form view cho Risk Metric -->
        <record id="view_risk_metric_form" model="ir.ui.view">
            <field name="name">risk.metric.form</field>
            <field name="model">risk.metric</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <group>
                                <field name="project_id"/>
                                <field name="metric_type"/>
                                <field name="date"/>
                            </group>
                            <group>
                                <field name="value"/>
                                <field name="threshold_min"/>
                                <field name="threshold_max"/>
                                <field name="is_anomaly" readonly="1"/>
                            </group>
                        </group>
                        <group>
                            <field name="notes" placeholder="Ghi ch√∫ v·ªÅ ch·ªâ s·ªë..."/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

    </data>
</odoo>
